---
permalink: /:basename
title: Demos
---

<!doctype html>

<html>
	<head>
		<title>Cade Conradson - {{ page.title }}</title>
		<link rel="shortcut icon" type="image/jpg" href="{{ site.url }}/assets/images/snakeface.jpg">
		<link rel="stylesheet" type="text/css" href="{{ site.url }}/assets/css/main.css">
		<link rel="stylesheet" type="text/css" href="{{ site.url }}/assets/css/column.css">
		<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
		<script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
		<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
		<style>
		.doubleslider-container {
			float: left;
			position: relative;
			width: 50%;
			height: 22px;
		}
		
		.dslider {
			position: absolute;
			-webkit-appearance: none;
			appearance: none;
			width: 100%;
		}
		
		.dslider::-webkit-slider-thumb {
			position: relative;
			z-index: 20;
		}
		
		.dslider::-moz-range-thumb {
			position: relative;
			z-index: 20;
		}
		
		.slidertext {
			float: left;
			width: 18px;
			margin-left: 4px;
		}
		
		.reset {
			float: left;
			margin-left: 5px;
		}
		
		.slidewrap:after {
			content: "";
			display: table;
			clear: both;
		}
		</style>
	</head>
	
	<body>
		<div id="wrap">
		
			<div id="header">
				<h3 class='site-title'>{{ site.title }}</h3>
				<p class='page-title'>{{ page.title }}</p>
			</div>
			
			<div class="nav">
				<a href="{{ site.url }}">Home</a>
				<a href="{{ site.url }}/projects/">Projects</a>
				<a href="{{ site.url }}/interests/">For Fun</a>
				<a href="{{ site.url }}/about/">About</a>
			</div>
			
			<div class = "body">
				Player: 
				<input type="text" id="player-input">
				<button onclick=changePlayer()>Make Plot</button>
				<button onclick=clearPlayer()>Clear</button>
				<input id="count" type="radio" name="prop" checked="checked" onclick=toCount()>
				<label for="count">Counts</label>
				<input id="prop" type="radio" name="prop" onclick=toProp()>
				<label for="prop">Proportions</label>
				<input id="allTiers" type="checkbox" onclick=changeAllTiers()>
				<label for="allTiers">Show all tiers</label>
				
				<div class="slidewrap">
					<p style="float:left;padding:0;margin:0">Seasons:</p>
					<input type="text" id="seasontextmin" class="slidertext" value="1" oninput=textinput() onblur=slideinput()>
					<div class="doubleslider-container">
						<input type="range" id="seasonslide1" class="dslider" min="1" max="41" value="1" oninput=slideinput()>
						<input type="range" id="seasonslide2" class="dslider" min="1" max="41" value="41" oninput=slideinput()>
					</div>
					<input type="text" id="seasontextmax" class="slidertext" value="41" oninput=textinput() onblur=slideinput()>
					<button class="reset" onclick=resetRange()>Reset Range</button> 
				</div>
				
				<div id="widthcheck"></div>
				<div id="visual">
					<script type="text/javascript">
					var counts = {{ site.data.leaguecounts | jsonify }};
					var placeHistory = {{ site.data.placeHistory | jsonify }};
					var proportion = false;
					var allTiers = true;
					var player = null;
					var seasonRange = [1,41];
					var userSetRange = false;
					var plot = null;
					
					document.getElementById('visual').style.padding = 0;
					makePlot();
					window.onresize = function () {
						plot.width(document.getElementById('widthcheck').clientWidth - 94);
						plot.height(0.6 * document.getElementById('widthcheck').clientWidth - 94);
						plot.runAsync();
					};
					
					
					var seasonslide1 = document.getElementById("seasonslide1");
					var seasonslide2 = document.getElementById("seasonslide2");
					var seasontextmin = document.getElementById("seasontextmin");
					var seasontextmax = document.getElementById("seasontextmax");
					
					function slideinput() {
						if (Number(seasonslide1.value) <= Number(seasonslide2.value)) {
							seasontextmin.value = seasonslide1.value;
							seasontextmax.value = seasonslide2.value;
						} else {
							seasontextmin.value = seasonslide2.value;
							seasontextmax.value = seasonslide1.value;
						}
						
						seasonRange = [Number(seasontextmin.value), Number(seasontextmax.value)];
						userSetRange = true;
						makePlot();
					}
					
					function textinput() {
						if (Number(seasontextmin.value) <= Number(seasontextmax.value)) {
							if (Number(seasonslide1.value) <= Number(seasonslide2.value)) {
								seasonslide1.value = seasontextmin.value;
								seasonslide2.value = seasontextmax.value;
							} else {
								seasonslide1.value = seasontextmax.value;
								seasonslide2.value = seasontextmin.value;
							}
							
							seasonRange = [Number(seasontextmin.value), Number(seasontextmax.value)];
							userSetRange = true;
							makePlot();
						}
					}
					
					function resetRange() {
						seasonRange = [1,41];
						userSetRange = false;
						seasontextmin.value = 1;
						seasontextmax.value = 41;
						seasonslide1.value = 1;
						seasonslide2.value = 41;
						makePlot();
					}

					
					function changePlayer() {
						player = document.getElementById('player-input').value;
						allTiers = proportion ? true : document.getElementById('allTiers').checked;
						makePlot();
					}
					
					function clearPlayer() {
						document.getElementById('player-input').value = "";
						player = null;
						if (userSetRange) {makePlot();} else {resetRange();};
					}
					
					function toCount() {
						if (proportion) {
							proportion = false;
							allTiers = document.getElementById('allTiers').checked;
							makePlot();
						}
					}
					
					function toProp() {
						if (!proportion) {
							proportion = true;
							allTiers = true;
							makePlot();
						}					
					}
					
					function changeAllTiers() {
						allTiers = proportion ? true : document.getElementById('allTiers').checked;						
						makePlot();
					}
					
					function makePlot() {
						var pHist = [];
						var tiers = [];
						var seasons = [];
						var fCounts = [];
						
						if (player) {
							//data slicing
							//isolate records for relevant player
							let lowerplayer = player.toLowerCase();
							for (let i = 0; i < placeHistory.length; i++) {
								if ((placeHistory[i].player.toLowerCase() == lowerplayer) && (Number(placeHistory[i].season) >= seasonRange[0]) && (Number(placeHistory[i].season) <= seasonRange[1])) {
									pHist.push(placeHistory[i]);
									seasons.push(placeHistory[i].season);
									tiers.push(placeHistory[i].tier);
								}
							}
							
							if (pHist.length) {
								//find missing seasons and insert nulls
								let start = userSetRange ? seasonRange[0] : Number(seasons[0]);
								let end = userSetRange ? seasonRange[1] : Number(seasons[seasons.length-1]);
								var toadd = [];
								for (let s = start; s <= end; s++) {
									if (!(seasons.includes(String(s)))) {
										pHist.push({"player":player, "tier":null, "division":null, "place":null, "season":String(s), "countPlacement":null, "propPlacement":null, "champ":null});
										toadd.push(String(s));
									}
								}
								pHist.sort(function(a,b){return a.season - b.season});
								seasons = seasons.concat(toadd).sort(function(a,b){return a - b});
								
								//show range on sliders if it changes upon plot making
								if (!userSetRange) {
									seasontextmin.value = seasons[0];
									seasontextmax.value = seasons[seasons.length - 1];
									seasonslide1.value = seasons[0];
									seasonslide2.value = seasons[seasons.length - 1];
								}
								
								//find needed tiers
								if (allTiers) {
									tiers = ["A","B","C","D","E","F","G","H","I","J"];
								} else {
									let potTiers = ["A","B","C","D","E","F","G","H","I","J"];
									let minTier = tiers.sort()[tiers.length - 1]
									let tempTiers = [];
									for (let i = 0; i < potTiers.length; i++) {
										if (potTiers[i] <= minTier) {tempTiers.push(potTiers[i]);} else {break;}
									}
									tiers = tempTiers;
								}
								
								var colors = ["#FF00FF","#9900FF","#0000FF","#4A85E8","#00FFFF","#00FF00","#FFFF00","#FF9800","#FF0000","#980000"];
								//cut colors because layers with same encoding annoyingly union their domains
								colors = colors.slice(0,tiers.length).concat(["#000000", "#000000", "#FFFF00"]);
								
								//filter counts to desired 
								if (allTiers) {
									for (let i = 0; i < counts.length; i++) {
										if (seasons.includes(counts[i].season)) {fCounts.push(counts[i]);}
									}
								} else {
									for (let i = 0; i < counts.length; i++) {
										if (seasons.includes(counts[i].season) && tiers.includes(counts[i].tier)) {fCounts.push(counts[i]);}
									}
								}
								
								//filter out later E seasons if player was in E before season 27
								if (tiers[tiers.length - 1] == "E") {
									let oldOnly = true;
									for (let i = pHist.length - 1; i >= 0; i--) {
										if (pHist[i].tier == "E" && Number(pHist[i].season > 26)) {
											oldOnly = false;
											break;
										}
									}
									if (oldOnly) {
										for (let i = fCounts.length - 1; i >= 0; i--) {
											if ((Number(fCounts[i].season) > 26) && (fCounts[i].tier == "E")) {
												fCounts.splice(i,1);
											}
										}
									}
								}
								
								var layers = [
									{
										"data": {"values": fCounts},
										"mark": "bar",
										"encoding": {
											"x": {
												"field": "season",
												"type": "ordinal",
												"scale": {
													"domain": seasons
												},
												"axis": {"title": "Season"}
											},
											"y": {
												"field": proportion ? "lfrac" : "players",
												"type": "quantitative",
												"scale": {
													"reverse": true,
													"domain": proportion ? [0,1] : null
												},
												"axis": {"title": "Position"}
											},
											"color": {
												"field": "tier",
												"type": "nominal",
												"scale": {
													"domain": tiers,
													"range": colors
												},
												"legend": {
													"title": "Tier",
													"values": tiers,
													"symbolType": "square",
													"symbolStrokeWidth": 0,
													"symbolSize": 200
												}
											},
											"order": {"field":"tier", "sort":"ascending"}
										}
									},
									{
										"data": {"values": pHist},
										"transform": [{"calculate": "if(datum.season.length == 1, '0' + datum.season, datum.season)", "as": "order"}],
										"mark": {"type": "line", "stroke": "#000000"},
										"encoding" : {
											"x": {"field": "season", "type": "ordinal"},
											"y": {
												"field": proportion ? "propPlacement" : "countPlacement",
												"type": "quantitative"
											},
											"order": {"field": "order", "type": "ordinal"}
										}
									},
									{
										"data": {"values": pHist},
										"selection": {
											"hovered": {"type": "single", "on": "mouseover", "empty": "none"},
											"clicked": {"type": "single", "on": "click", "empty": "none"}
										},
										"mark": {
											"type": "point",
											"filled": true,
											"opacity": "1",
											"stroke": "#000000",
											"strokeWidth": "1"
										},
										"encoding": {
											"x": {"field": "season", "type": "ordinal"},
											"y": {
												"field": proportion ? "propPlacement" : "countPlacement",
												"type": "quantitative"
											},
											"color": {
												"field": "champ",
												"type": "nominal",
												"scale": {
													"domain": ["no", "division", "league"]
												}
											},
											"shape": {
												"field": "champ",
												"type": "nominal",
												"scale": {
													"domain": ["no", "division", "league"],
													"range": [
														"M 0 -1 A 1 1 0 1 1 0 1 A 1 1 0 1 1 0 -1", 
														"M 0 -2 L -0.36327126400268 -0.5 L -1.90211303259031 -0.618033988749895 L -0.587785252292473 0.190983005625053 L -1.17557050458495 1.61803398874989 L -7.56848349501309e-17 0.618033988749895 L 1.17557050458495 1.6180339887499 L 0.587785252292473 0.190983005625053 L 1.90211303259031 -0.618033988749894 L 0.363271264002681 -0.5 L 4.89842541528951e-16 -2 L -0.36327126400268 -0.5",
														"M 0 -2.4 L -0.435925516803217 -0.6 L -2.28253563910837 -0.741640786499874 L -0.705342302750968 0.229179606750063 L -1.41068460550194 1.94164078649987 L -9.0821801940157e-17 0.741640786499874 L 1.41068460550194 1.94164078649987 L 0.705342302750968 0.229179606750063 L 2.28253563910837 -0.741640786499873 L 0.435925516803217 -0.6 L 5.87811049834741e-16 -2.4 L -0.435925516803216 -0.600000000000001"
													]
												},
												"legend": null
											},
											"size": {"condition": {"selection": "hovered", "value": "60"}, "value": "40"},
											"tooltip": [
												{"field": "season", "type": "nominal", "title": "Season"},
												{"field": "division", "type": "nominal", "title": "Division"},
												{"field": "place", "type": "nominal", "title": "Finish"}
											]
										}
									}
								];
							} else {
								//add message saying not found at some point
								player = null;
								var layers = nullPlotLayer();
							}
						} else {
							var layers = nullPlotLayer();
						}
						
						const spec = {
							"title": player ? ("League History: " + player) : "League History",
							"width": document.getElementById('widthcheck').clientWidth - 94, //little bit off with scrollbar, worry when doing resizing for window
							"height": 0.6 * (document.getElementById('widthcheck').clientWidth - 94),
							"layer": layers				
						};
						vegaEmbed("#visual", spec, {"actions": false}).then(function(res) {
							plot = res.view;
							if (player) {
								plot.addDataListener('clicked_store', function(name, value){
									let roi = pHist[value[0].values[0] - fCounts.length - 1];
									showStandingsModal(roi.season, roi.division);
								})
							}
						});
					}
					
					function nullPlotLayer() {
						let seasons = [];
						let fCounts = [];
						let start = userSetRange ? seasonRange[0] : 1;
						let end = userSetRange ? seasonRange[1] : 41;
						for (let s = start; s <= end; s++) {seasons.push(String(s));}
						if (userSetRange) {
							for (let i = 0; i < counts.length; i++) {
								if ((Number(counts[i].season) >= start) && (Number(counts[i].season) <= end)) {fCounts.push(counts[i]);}
							}
						}
						
						return [{
							"data": {"values": userSetRange ? fCounts : counts},
							"mark": "bar",
							"encoding": {
								"x": {
									"field": "season",
									"type": "ordinal",
									"scale": {
										"domain": seasons
									},
									"axis": {"title": "Season"}
								},
								"y": {
									"field": proportion ? "lfrac" : "players",
									"type": "quantitative",
									"scale": {
										"reverse": true,
										"domain": proportion ? [0,1] : null
									},
									"axis": {"title": proportion ? "Proportion" : "Position"}
								},
								"color": {
									"field": "tier",
									"type": "nominal",
									"scale": {
										"domain": ["A","B","C","D","E","F","G","H","I","J"],
										"range": ["#FF00FF","#9900FF","#0000FF","#4A85E8","#00FFFF","#00FF00","#FFFF00","#FF9800","#FF0000","#980000"]
									},
									"legend": {
										"title": "Tier",
										"values": ["A","B","C","D","E","F","G","H","I","J"],
										"symbolType": "square",
										"symbolStrokeWidth": 0,
										"symbolSize": 200
									}
								},
								"order": {"field":"tier", "sort":"ascending"}
							}
						}];
					}
					
					function showStandingsModal(season, division) {
						window.alert("I haven't actually made the modals yet but it would show standings for season " + season + ", division " + division)
					}
					</script>
				</div>
			</div>
		
		</div>
	</body>
</html>